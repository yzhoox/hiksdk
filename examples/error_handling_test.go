package examples

import (
	"testing"

	"github.com/samsaralc/hiksdk/core"
	"github.com/samsaralc/hiksdk/core/auth"
)

// TestErrorHandling é”™è¯¯å¤„ç†ç¤ºä¾‹
// å±•ç¤ºç»Ÿä¸€çš„ HKError é”™è¯¯ç»“æ„ä½“ä½¿ç”¨æ–¹æ³•
func TestErrorHandling(t *testing.T) {
	t.Log("========================================")
	t.Log("æµ·åº·å¨è§† SDK - é”™è¯¯å¤„ç†ç¤ºä¾‹")
	t.Log("========================================")

	// ==================== æµ‹è¯•1: é”™è¯¯çš„ç”¨æˆ·å/å¯†ç  ====================
	t.Log("\n[æµ‹è¯•1] é”™è¯¯çš„ç”¨æˆ·å/å¯†ç ï¼ˆé¢„æœŸé”™è¯¯ç  1ï¼‰")
	cred1 := &auth.Credentials{
		IP:       "192.168.1.64",
		Port:     8000,
		Username: "wrong_user",
		Password: "wrong_pass",
	}

	_, err := auth.LoginV30(cred1)
	if err != nil {
		t.Logf("âœ“ æ•è·åˆ°é”™è¯¯: %v", err)

		// è§£æä¸º HKError è·å–è¯¦ç»†ä¿¡æ¯
		if hkErr, ok := err.(*core.HKError); ok {
			t.Logf("  é”™è¯¯ç : %d", hkErr.Code)
			t.Logf("  é”™è¯¯æè¿°: %s", hkErr.Msg)
			t.Logf("  æ“ä½œ: %s", hkErr.Operation)
			t.Logf("  JSONæ ¼å¼: %s", hkErr.JSON())
		}
	} else {
		t.Log("âš ï¸  æœªé¢„æœŸçš„æˆåŠŸ")
	}

	// ==================== æµ‹è¯•2: è®¾å¤‡ä¸åœ¨çº¿ ====================
	t.Log("\n[æµ‹è¯•2] è®¾å¤‡ä¸åœ¨çº¿ï¼ˆé¢„æœŸé”™è¯¯ç  7ï¼‰")
	cred2 := &auth.Credentials{
		IP:       "192.168.1.254", // ä¸å­˜åœ¨çš„IP
		Port:     8000,
		Username: "admin",
		Password: "password",
	}

	_, err = auth.LoginV40(cred2)
	if err != nil {
		t.Logf("âœ“ æ•è·åˆ°é”™è¯¯: %v", err)

		// ç±»å‹æ–­è¨€è·å–è¯¦ç»†ä¿¡æ¯
		if hkErr, ok := err.(*core.HKError); ok {
			t.Logf("  é”™è¯¯ç : %d", hkErr.Code)
			t.Logf("  é”™è¯¯æè¿°: %s", hkErr.Msg)
		}
	} else {
		t.Log("âš ï¸  æœªé¢„æœŸçš„æˆåŠŸ")
	}

	// ==================== æµ‹è¯•3: é”™è¯¯çš„ç«¯å£ ====================
	t.Log("\n[æµ‹è¯•3] é”™è¯¯çš„ç«¯å£ï¼ˆé¢„æœŸé”™è¯¯ç  7ï¼‰")
	cred3 := &auth.Credentials{
		IP:       "192.168.1.64",
		Port:     9999, // é”™è¯¯çš„ç«¯å£
		Username: "admin",
		Password: "password",
	}

	_, err = auth.LoginV30(cred3)
	if err != nil {
		t.Logf("âœ“ æ•è·åˆ°é”™è¯¯: %v", err)
	} else {
		t.Log("âš ï¸  æœªé¢„æœŸçš„æˆåŠŸ")
	}

	// ==================== HKError ç»“æ„ä½“ç‰¹æ€§ ====================
	t.Log("\n========================================")
	t.Log("HKError ç»“æ„ä½“ç‰¹æ€§")
	t.Log("========================================")
	t.Log("  â€¢ ç»Ÿä¸€çš„é”™è¯¯å¤„ç†ä½“ç³»")
	t.Log("  â€¢ åŒ…å«é”™è¯¯ç ã€é”™è¯¯æè¿°ã€æ“ä½œåç§°")
	t.Log("  â€¢ æ”¯æŒ JSON åºåˆ—åŒ–")
	t.Log("  â€¢ å®ç° error æ¥å£")
	t.Log("  â€¢ å¯ä»¥é€šè¿‡ç±»å‹æ–­è¨€è·å–è¯¦ç»†ä¿¡æ¯")

	// ==================== å¸¸è§é”™è¯¯ç è¯´æ˜ ====================
	t.Log("\n========================================")
	t.Log("å¸¸è§é”™è¯¯ç è¯´æ˜")
	t.Log("========================================")
	t.Log("  é”™è¯¯ç  1ï¼šç”¨æˆ·åæˆ–å¯†ç é”™è¯¯")
	t.Log("  é”™è¯¯ç  7ï¼šè¿æ¥è®¾å¤‡å¤±è´¥ï¼Œè®¾å¤‡ä¸åœ¨çº¿æˆ–ç½‘ç»œè¶…æ—¶")
	t.Log("  é”™è¯¯ç  4ï¼šé€šé“å·é”™è¯¯")
	t.Log("  é”™è¯¯ç  17ï¼šå‚æ•°é”™è¯¯")
	t.Log("  é”™è¯¯ç  23ï¼šè®¾å¤‡ä¸æ”¯æŒè¯¥åŠŸèƒ½")
	t.Log("  é”™è¯¯ç  30ï¼šç”¨æˆ·æ•°è¾¾åˆ°æœ€å¤§")
	t.Log("  é”™è¯¯ç  86ï¼šæ²¡æœ‰ç›¸åº”çš„ä¸Šä¼ é€šé“èµ„æº")

	t.Log("\nğŸ’¡ ä½¿ç”¨å»ºè®®:")
	t.Log("  â€¢ æ‰€æœ‰é”™è¯¯éƒ½è¿”å› *core.HKError ç±»å‹")
	t.Log("  â€¢ ç›´æ¥æ‰“å°é”™è¯¯å³å¯è·å¾—æ¸…æ™°çš„æè¿°")
	t.Log("  â€¢ éœ€è¦è¯¦ç»†ä¿¡æ¯æ—¶ä½¿ç”¨ç±»å‹æ–­è¨€")
	t.Log("  â€¢ æ‰€æœ‰æ¨¡å—ï¼ˆç™»å½•ã€PTZã€æŠ¥è­¦ï¼‰ç»Ÿä¸€ä½¿ç”¨ HKError")
}
